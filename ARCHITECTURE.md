# System Architecture - Shourya Turf & Sports Academy

## High-Level Architecture

```
┌─────────────────────────────────────────────────────────────────┐
│                         CLIENT LAYER                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │    Login     │  │  Dashboard   │  │   Booking    │          │
│  │  Component   │  │  Component   │  │  Component   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │    Admin     │  │   Payment    │  │   Guards     │          │
│  │  Component   │  │  Component   │  │ & Interceptor│          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                   │
│                    Angular 17 Frontend                           │
│                    (Port 4200)                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ HTTP/HTTPS
                              │ REST API Calls
                              │ JWT Token
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                      APPLICATION LAYER                           │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                    Express.js Server                      │  │
│  │                      (Port 5000)                          │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│  ┌───────────────┬───────────┴───────────┬──────────────────┐  │
│  │               │                       │                   │  │
│  ▼               ▼                       ▼                   ▼  │
│  ┌─────────┐  ┌─────────┐  ┌──────────┐  ┌──────────────┐  │
│  │  Auth   │  │ Booking │  │ Payment  │  │    Admin     │  │
│  │ Routes  │  │ Routes  │  │  Routes  │  │   Routes     │  │
│  └─────────┘  └─────────┘  └──────────┘  └──────────────┘  │
│       │             │             │               │           │
│       ▼             ▼             ▼               ▼           │
│  ┌─────────┐  ┌─────────┐  ┌──────────┐  ┌──────────────┐  │
│  │  Auth   │  │ Booking │  │ Payment  │  │    Admin     │  │
│  │Controller│ │Controller│ │Controller│  │  Controller  │  │
│  └─────────┘  └─────────┘  └──────────┘  └──────────────┘  │
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │              Middleware Layer                             │  │
│  │  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐  │  │
│  │  │     CORS     │  │     JWT      │  │    Role      │  │  │
│  │  │              │  │     Auth     │  │    Check     │  │  │
│  │  └──────────────┘  └──────────────┘  └──────────────┘  │  │
│  └──────────────────────────────────────────────────────────┘  │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
                              │
                              │ Mongoose ODM
                              ▼
┌─────────────────────────────────────────────────────────────────┐
│                        DATA LAYER                                │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌──────────────────────────────────────────────────────────┐  │
│  │                    MongoDB Database                       │  │
│  │                  (Port 27017)                             │  │
│  └──────────────────────────────────────────────────────────┘  │
│                              │                                   │
│  ┌───────────────┬───────────┴───────────┬──────────────────┐  │
│  │               │                       │                   │  │
│  ▼               ▼                       ▼                   ▼  │
│  ┌─────────┐  ┌─────────┐  ┌──────────┐                     │
│  │  Users  │  │Bookings │  │ Payments │                     │
│  │Collection│ │Collection│ │Collection│                     │
│  └─────────┘  └─────────┘  └──────────┘                     │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘


┌─────────────────────────────────────────────────────────────────┐
│                    EXTERNAL SERVICES                             │
├─────────────────────────────────────────────────────────────────┤
│                                                                   │
│  ┌──────────────┐  ┌──────────────┐  ┌──────────────┐          │
│  │   Razorpay   │  │   Nodemailer │  │    Twilio    │          │
│  │   (Payment)  │  │  (Email OTP) │  │  (SMS OTP)   │          │
│  └──────────────┘  └──────────────┘  └──────────────┘          │
│                                                                   │
└─────────────────────────────────────────────────────────────────┘
```

## Data Flow Diagrams

### 1. User Registration & Login Flow

```
User                Frontend              Backend              Database         External
 │                     │                     │                     │               │
 │  Enter Email/Mobile │                     │                     │               │
 │────────────────────>│                     │                     │               │
 │                     │  POST /auth/send-otp│                     │               │
 │                     │────────────────────>│                     │               │
 │                     │                     │  Find/Create User   │               │
 │                     │                     │────────────────────>│               │
 │                     │                     │  Generate OTP       │               │
 │                     │                     │  Save OTP & Expiry  │               │
 │                     │                     │────────────────────>│               │
 │                     │                     │  Send Email/SMS     │               │
 │                     │                     │─────────────────────────────────────>│
 │  OTP Sent           │                     │                     │               │
 │<────────────────────│<────────────────────│                     │               │
 │                     │                     │                     │               │
 │  Enter OTP          │                     │                     │               │
 │────────────────────>│                     │                     │               │
 │                     │ POST /auth/verify-otp│                    │               │
 │                     │────────────────────>│                     │               │
 │                     │                     │  Verify OTP         │               │
 │                     │                     │────────────────────>│               │
 │                     │                     │  Generate JWT       │               │
 │  JWT Token + User   │                     │                     │               │
 │<────────────────────│<────────────────────│                     │               │
 │                     │                     │                     │               │
```

### 2. Booking & Payment Flow

```
User              Frontend           Backend          Database        Razorpay
 │                   │                  │                 │               │
 │  Select Turf      │                  │                 │               │
 │  Date & Time      │                  │                 │               │
 │──────────────────>│                  │                 │               │
 │                   │ GET /bookings/   │                 │               │
 │                   │ available-slots  │                 │               │
 │                   │─────────────────>│                 │               │
 │                   │                  │ Check Bookings  │               │
 │                   │                  │────────────────>│               │
 │  Available Slots  │                  │                 │               │
 │<──────────────────│<─────────────────│                 │               │
 │                   │                  │                 │               │
 │  Confirm Booking  │                  │                 │               │
 │──────────────────>│                  │                 │               │
 │                   │ POST /bookings   │                 │               │
 │                   │─────────────────>│                 │               │
 │                   │                  │ Create Booking  │               │
 │                   │                  │────────────────>│               │
 │                   │                  │                 │               │
 │                   │ POST /payments/  │                 │               │
 │                   │ create-order     │                 │               │
 │                   │─────────────────>│                 │               │
 │                   │                  │ Create Order    │               │
 │                   │                  │─────────────────────────────────>│
 │                   │  Order Details   │                 │               │
 │                   │<─────────────────│<─────────────────────────────────│
 │                   │                  │                 │               │
 │  Razorpay Popup   │                  │                 │               │
 │<──────────────────│                  │                 │               │
 │                   │                  │                 │               │
 │  Complete Payment │                  │                 │               │
 │──────────────────────────────────────────────────────────────────────>│
 │                   │                  │                 │               │
 │  Payment Success  │                  │                 │               │
 │<──────────────────────────────────────────────────────────────────────│
 │                   │                  │                 │               │
 │                   │ POST /payments/  │                 │               │
 │                   │ verify           │                 │               │
 │                   │─────────────────>│                 │               │
 │                   │                  │ Verify Signature│               │
 │                   │                  │ Update Payment  │               │
 │                   │                  │ Update Booking  │               │
 │                   │                  │────────────────>│               │
 │  Booking Confirmed│                  │                 │               │
 │<──────────────────│<─────────────────│                 │               │
 │                   │                  │                 │               │
```

### 3. Admin Dashboard Flow

```
Admin             Frontend           Backend          Database
 │                   │                  │                 │
 │  Login as Admin   │                  │                 │
 │──────────────────>│                  │                 │
 │                   │ POST /auth/      │                 │
 │                   │ verify-otp       │                 │
 │                   │─────────────────>│                 │
 │                   │                  │ Check Role      │
 │                   │                  │────────────────>│
 │  Redirect to      │                  │                 │
 │  Admin Dashboard  │                  │                 │
 │<──────────────────│                  │                 │
 │                   │                  │                 │
 │                   │ GET /admin/      │                 │
 │                   │ dashboard        │                 │
 │                   │─────────────────>│                 │
 │                   │                  │ Aggregate Stats │
 │                   │                  │────────────────>│
 │  Dashboard Stats  │                  │                 │
 │<──────────────────│<─────────────────│                 │
 │                   │                  │                 │
 │                   │ GET /bookings/all│                 │
 │                   │─────────────────>│                 │
 │                   │                  │ Fetch All       │
 │                   │                  │────────────────>│
 │  All Bookings     │                  │                 │
 │<──────────────────│<─────────────────│                 │
 │                   │                  │                 │
 │  Update Status    │                  │                 │
 │──────────────────>│                  │                 │
 │                   │ PUT /bookings/   │                 │
 │                   │ :id/status       │                 │
 │                   │─────────────────>│                 │
 │                   │                  │ Update Booking  │
 │                   │                  │────────────────>│
 │  Status Updated   │                  │                 │
 │<──────────────────│<─────────────────│                 │
 │                   │                  │                 │
```

## Component Interaction Map

```
┌─────────────────────────────────────────────────────────────┐
│                    FRONTEND COMPONENTS                       │
└─────────────────────────────────────────────────────────────┘
                              │
                              │
        ┌─────────────────────┼─────────────────────┐
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐     ┌──────────────┐
│    Login     │      │  Dashboard   │     │    Admin     │
│  Component   │      │  Component   │     │  Component   │
└──────────────┘      └──────────────┘     └──────────────┘
        │                     │                     │
        │                     │                     │
        ▼                     ▼                     ▼
┌──────────────┐      ┌──────────────┐     ┌──────────────┐
│    Auth      │      │   Booking    │     │    Admin     │
│   Service    │      │   Service    │     │   Service    │
└──────────────┘      └──────────────┘     └──────────────┘
        │                     │                     │
        └─────────────────────┼─────────────────────┘
                              │
                              ▼
                    ┌──────────────────┐
                    │  Auth Interceptor│
                    │  (Add JWT Token) │
                    └──────────────────┘
                              │
                              ▼
┌─────────────────────────────────────────────────────────────┐
│                    BACKEND ROUTES                            │
└─────────────────────────────────────────────────────────────┘
```

## Security Flow

```
Request → CORS Check → JWT Validation → Role Check → Controller → Response
   │          │              │              │            │
   │          ▼              ▼              ▼            ▼
   │      Allow Origin   Verify Token   Check Role   Execute Logic
   │      Check Method   Extract User   Admin/User   Access Database
   │                                                  Return Data
   │
   └─── If any check fails → Return 401/403 Error
```

## Database Relationships

```
┌──────────────┐
│    Users     │
│              │
│  _id         │◄─────────┐
│  name        │          │
│  email       │          │ (user reference)
│  mobile      │          │
│  role        │          │
└──────────────┘          │
                          │
                          │
                ┌─────────┴────────┐
                │                  │
                │                  │
        ┌───────▼──────┐   ┌──────▼──────┐
        │   Bookings   │   │   Payments  │
        │              │   │             │
        │  _id         │◄──┤  booking    │
        │  user        │   │  user       │
        │  turfType    │   │  amount     │
        │  date        │   │  status     │
        │  timeSlot    │   │  razorpay*  │
        │  amount      │   └─────────────┘
        │  status      │
        │  paymentId   │
        └──────────────┘
```

## Deployment Architecture

```
┌─────────────────────────────────────────────────────────────┐
│                         PRODUCTION                           │
└─────────────────────────────────────────────────────────────┘

    ┌──────────────┐         ┌──────────────┐
    │   Vercel     │         │    Render    │
    │  (Frontend)  │────────>│  (Backend)   │
    │              │  HTTPS  │              │
    └──────────────┘         └──────────────┘
           │                        │
           │                        │
           │                        ▼
           │              ┌──────────────────┐
           │              │  MongoDB Atlas   │
           │              │   (Database)     │
           │              └──────────────────┘
           │
           │
           ▼
    ┌──────────────┐
    │  Razorpay    │
    │  (Payments)  │
    └──────────────┘
```

---

**This architecture ensures:**
- ✅ Scalability
- ✅ Security
- ✅ Maintainability
- ✅ Performance
- ✅ Reliability
